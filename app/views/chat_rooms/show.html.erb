<div class="chat-container">
    <h1 class="chat-title">チャットルーム</h1>
    <div class="messages" id="messages">
        <% if @messages %>
            <% grouped_messages = @messages.group_by { |message| message.created_at.to_date } %>
            <% grouped_messages.each do |date, messages| %>
                <div class="date-divider">
                    <span class="date"><%= date.strftime("%Y/%m/%d") %></span>
                </div>
                <% messages.each do |message| %>
                    <div class="message <%= 'my-message' if message.user == current_user %>">
                        <% if message.user == current_user %>
                            <span class="timestamp message-meta"><%= message.created_at.strftime("%H:%M") %></span>
                        <% end %>
                        <div class="message-content">
                            <% unless message.user == current_user %>
                                <strong class="username"><%= message.user.username %>:</strong>
                                <span class="timestamp message-meta"><%= message.created_at.strftime("%H:%M") %></span>
                            <% end %>
                            <p class="content"><%= message.content %></p>
                        </div>
                    </div>
                <% end %>
            <% end %>
        <% else %>
            <p class="no-messages">メッセージはありません。</p>
        <% end %>
    </div>

  <%= form_with(model: [ @chat_room, @message ], url: chat_room_messages_path(@chat_room), html: { class: 'message-form' }) do |form| %>
    <%= form.text_area :content, class: 'text-area' %>
    <%= form.submit "送信", class: 'send-button' %>
  <% end %>

  <%= link_to "戻る", fishing_trips_path, class: 'back-link' %>
</div>
